---
title: "Interpret ColocBoost Output"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Interpret ColocBoost Output}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


This vignette demonstrates how to interpret the output of ColocBoost, specifically to get the summary of colocalization and filtering our the weak signals.

```{r setup}
library(colocboost)
```

## 1. Summarize ColocBoost results

### Causal variant structure
The dataset features two causal variants with indices 644 and 2289.

- Causal variant 644 is associated with traits 1, 2, 3, and 4.
- Causal variant 2289 is associated with traits 2, 3, and 5.

```{r run-colocboost}
# Loading the Dataset
data(Ind_5traits)
# Run colocboost 
res <- colocboost(X = Ind_5traits$X, Y = Ind_5traits$Y)
cos_summary <- res$cos_summary
names(cos_summary)
```

The `cos_summary` object contains the colocalization summary for all colocalization events, with each row representing a single colocalization event.
The summary includes the following columns:


- **focal_outcome**: The focal outcome being analyzed, or `FALSE` if no focal outcome exists.
- **colocalized_outcomes**: Traits that are colocalized within the 95% colocalization confidence set (CoS).
- **cos_id**: A unique identifier for each 95% colocalization confidence set (CoS).
- **purity**: The minimum absolute correlation of variants within the 95% colocalization confidence set (CoS).
- **top_variable**: The variable with the highest variant colocalization probability (VCP).
- **top_variable_vcp**: The variant colocalization probability for the top variable.
- **cos_npc**: The normalized probability of colocalization for the 95% confidence set, providing empirical evidence in favor of colocalization over a trait-specific configuration.
- **min_npc_outcome**: The minimum normalized probability among colocalized traits.
- **n_variables**: The number of variables in the 95% colocalization confidence set (CoS).
- **colocalized_index**: The indices of colocalized variables.
- **colocalized_variables**: A list of colocalized variables.
- **colocalized_variables_vcp**: The variant colocalization probabilities for all colocalized variables.


To obtain the summary of colocalization with a specific focus on traits of interest, 
you can use the `get_cos_summary`, see detailed usage of this function in [link](https://statfungen.github.io/colocboost/reference/get_cos_summary.html). 
This function allows you to filter the colocalization summary based on a particular outcome of interest, 
making it easier to interpret the results for specific traits. 
For example, if you are interested in the colocalization events involving the traits `Y1` and `Y2`, you can use the following code:


```{r summary-colocboost}
# Get summary table of colocalization
cos_interest_outcome <- get_cos_summary(res, interest_outcome = c("Y1", "Y2"))
```



## 2. Filter colocalization events by relative strength of evidence

In `cos_summary`, for each 95% CoS, the `cos_npc` column provides a normalized probability of colocalization and
`min_npc_outcome` column provides the minimum normalized probability among colocalized traits.
Those two metrices are measured as an empirical evidence of colocalization both in CoS-level and in trait-level.
To obtain the best minimal colocalization configuration can be defined by using both `cos_npc` and `npc_outcome`
See detailed usage of this function in [link](https://statfungen.github.io/colocboost/reference/get_robust_colocalization.html).


```{r run-strong-colocalization}
filter_res <- get_robust_colocalization(res, cos_npc_cutoff = 0.5, npc_outcome_cutoff = 0.2)
```

- The output from `get_robust_colocalization` is the same as output from `colocboost`, which can be directly used in any post inference and visualization.
- `npc=0.5` or `npc_outcome = 0.2` maintains robust colocalization signals for cases when many traits are evaluated. 
Higher thresholds can be specified if users only want to focus on strong colocalization events.


## 3. More details on ColocBoost output

The entire colocalization output from `colocboost` is stored in the `colocboost` object, which contains several components:

- **`cos_summary`**: A summary table for colocalization events (see details in above Section 1).
- **`vcp`**: The variable colocalized probability for each variable.
- **`cos_details`**: A object with all information for colocalization results.
- **`data_info`**: A object with detailed information from input data.
- **`model_info`**: A object with detailed information for colocboost model.

In this section, we will provide a detailed explanation of the components for deepening into ColocBoost result using a mixed dataset.

```{r load-mixed-data}
# Load example data
data(Ind_5traits)
data(Sumstat_5traits) 
# Create a mixed dataset
X <- Ind_5traits$X[1:4]
Y <- Ind_5traits$Y[1:4]
sumstat <- Sumstat_5traits$sumstat[5]
LD <- get_cormat(Ind_5traits$X[[1]])
# Run colocboost
res <- colocboost(X = X, Y = Y, sumstat = sumstat, LD = LD)
```

### 3.1. Variant colocalization probability (**`vcp`**)

- **`vcp`** is the probability of a variant being colocalized with at least one traits, serving as analogs of posterior inclusion probabilities (PIPs) in single-trait fine-mapping.
To plot the VCP for the variants with in at least one CoS, you can use the `colocboost_plot` function with the `y` argument set to `"vcp"`. 


```{r vcp-plot}
colocboost_plot(res, y = "vcp")
```

Please visit our documentation portal 
at [Visualization of ColocBoost Results](https://statfungen.github.io/colocboost/articles/Visualization_ColocBoost_Output.html) for more details on the `colocboost_plot` function

### 3.2. Analyzed data information (**`data_info`**)

- **`n_variables`**: number of variants being included.
- **`variables`**: vector of variant names across all traits being included in colocalization analysis.
- **`coef`**: regression coefficients estimated from the colocboost model for each trait.
- **`z`**: z-scores from marginal associations for each trait.
- **`n_outcomes`**: the number of traits being included in colocalization analysis.
- **`outcome_info`** contains information of analyzed data, including sample size and data type.

```{r analyzed-data-info}
res$data_info$outcome_info
```


### 3.3. Colocalization details (**`cos_details`**)

**`cos_details`** provides detailed information for colocalization evetns identified by `colocboost`. 
This section will provide a detailed explanation of the components in `cos_details`.

#### 3.3.1. Colocalized variants for each CoS (**`cos`**)

- **`cos`**: A list with detailed information of colocalized variants for each CoS. 
  - **`cos_index`**: Indices of colocalized variables with unique identifier for each CoS.
  - **`cos_variables`**: Names of colocalized variables with unique identifier for each CoS.
- Note that variants are ordered by their VCP in descending order.

```{r cos}
res$cos_details$cos
```

#### 3.3.2. Colocalized traits for each 95% CoS (**`cos_outcomes`**)

- **`cos_outcomes`**: A list with detailed information of colocalized traits for each CoS. 
  - **`outcome_index`**: Indices of colocalized traits with unique identifier for each CoS.
  - **`outcome_name`**: Names of colocalized traits with unique identifier for each CoS.

```{r cos-outcome}
res$cos_details$cos_outcomes
```

- **`cos_npc`**: normalized probability of colocalization for CoS, providing empirical evidence in favor of colocalization over a trait-specific configuration.
- **`cos_outcomes_npc`**: normalized probability for each colocalized trait in order with evidence strength.
- These two metrices could be used to filter the colocalization events by relative strength of evidence, see details in Section 2.


```{r cos-npc}
res$cos_details$cos_npc
res$cos_details$cos_outcomes_npc
```


- **`cos_purity`**: includes three lists, for each list, it contains $S \times S$ matrix, where $S$ is the number of CoS. 
  - `min_abs_cor`: the minimum absolute correlation of variants within (diagonal) CoS or in-between (off-diagonal) different CoS.
  - `median_abs_cor`: the median absolute correlation of variants within (diagonal) CoS or in-between (off-diagonal) different CoS.
  - `max_abs_cor`: the maximum absolute correlation of variants within (diagonal) CoS or in-between (off-diagonal) different CoS.

```{r cos-purity}
res$cos_details$cos_purity
```


- **`cos_top_variables`**: indicies and names of the top variant for each CoS, which is the variant with the highest VCP.
- Note that there may exist multiple variants in perfect LD with the same highest VCP.

```{r cos-top}
res$cos_details$cos_top_variables
```

- **`cos_weights`**: the integrative weights for each colocalized trait in the CoS. This is used to re-calibrate CoS when some traits are filtered out..
- **`cos_vcp`**: the single-effect VCP for each CoS.


### 3.4. Model information (**`model_info`**)

- **`model_coveraged`**: if the model is converged.
- **`n_updates`**: number of boosting rounds
- **`jk_update`**: indices of the variants being updated in the model at each boosting round. 

```{r jk_update}
# Pick arbitrary SEC updates, see entire update in advance
res$model_info$jk_update[c(5:10,36:38), ]
```

- **`profile_loglik`**: joint profile log-likelihood changes over boosting rounds.
- **`outcome_profile_loglik`**: trait-specifc profile log-likelihood changes over boosting rounds.

```{r profile_loglik}
par(mfrow=c(2,3),mar=c(4,4,2,1))
plot(res$model_info$profile_loglik, type="p", col="#3366CC", lwd=2, xlab="", ylab="Joint Profile")
for(i in 1:5){
plot(res$model_info$outcome_profile_loglik[[i]], type="p", col="#CC3333", lwd=2, xlab="", ylab=paste0("Profile (Trait ", i, ")"))
}
```

- **`outcome_proximity_obj`**: trait-specific proximity smoothed objective for each trait.
- **`outcome_coupled_best_update_obj`**: objective at the (coupled) best update variant for each outcome.


```{r objetive-proximity}
par(mfrow=c(2,3), mar=c(4,4,2,1))
for(i in 1:5){
plot(res$model_info$outcome_proximity_obj[[i]], type="p", col="#3366CC", lwd=2, xlab="", ylab="Trait-specific Objective", main = paste0("Trait ", i))
}
```

```{r objetive-best}
par(mfrow=c(2,3), mar=c(4,4,2,1))
for(i in 1:5){ 
  plot(res$model_info$outcome_coupled_best_update_obj[[i]], type="p", col="#CC3333", lwd=2, xlab="", ylab=paste0("Objetive at best update variant"), main = paste0("Trait ", i)) 
}
```



## 4. Trait-specific effects information (UCoS)

TO-DO-LIST

```{r ucos-details}
res <- colocboost(X = X, Y = Y, sumstat = sumstat, LD = LD, output_level = 2)
```

## 5. Diagnostic details

TO-DO-LIST

For more diagnosis of ColocBoost model fitting, please refer to our Tutorial (TO-DO-LIST).
